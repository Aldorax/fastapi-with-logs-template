{
    "thread": 459014,
    "level_name": "Information",
    "message": "Started server process [459014]",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:50:58+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 320
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Waiting for application startup.",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:50:58+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 320
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Application startup complete.",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:50:58+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 321
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Got /",
    "source_log": "main",
    "@timestamp": "2022-03-16T09:51:03+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 649
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Answer code: 200 request url: GET \"http://127.0.0.1:8888/\" duration: 2 ms ",
    "source_log": "main",
    "@timestamp": "2022-03-16T09:51:03+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 2,
    "request_uri": "http://127.0.0.1:8888/",
    "request_referer": "http://127.0.0.1:8888/docs",
    "request_method": "GET",
    "request_path": "/",
    "request_host": "127.0.0.1:8888",
    "request_size": 0,
    "request_content_type": "",
    "request_headers": {
        "host": "127.0.0.1:8888",
        "connection": "keep-alive",
        "sec-ch-ua": "\"Chromium\";v=\"98\", \" Not A;Brand\";v=\"99\"",
        "accept": "application/json",
        "sec-ch-ua-mobile": "?0",
        "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.121 Safari/537.36",
        "sec-ch-ua-platform": "\"Linux\"",
        "sec-fetch-site": "same-origin",
        "sec-fetch-mode": "cors",
        "sec-fetch-dest": "empty",
        "referer": "http://127.0.0.1:8888/docs",
        "accept-encoding": "gzip, deflate, br",
        "accept-language": "ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7",
        "cookie": "_pk_id.1.dc78=4ec40eae396f1c32.1645453915.; GUID_20B40965CCF8B7300FCB1E3B5CB9925FB27970B0_8888=NcjlKqKxMJq9RgiYXEf3; io=fSKn7g-dE_J63nxDAAAA"
    },
    "request_body": "",
    "request_direction": "in",
    "response_status_code": 200,
    "response_size": 22,
    "response_headers": {
        "content-length": "22",
        "content-type": "application/json"
    },
    "response_body": "{\"answer\":\"I am Root\"}"
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Got /error, one=1, two=0",
    "source_log": "main",
    "@timestamp": "2022-03-16T09:51:07+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 173
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Error code: 500 request url: GET \"http://127.0.0.1:8888/error?one=1&two=0\" duration: 2 ms ",
    "source_log": "main",
    "@timestamp": "2022-03-16T09:51:07+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 2,
    "exceptions": [
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/middleware/base.py\", line 41, in call_next",
        "    message = await recv_stream.receive()",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/anyio/streams/memory.py\", line 81, in receive",
        "    78   async def receive(self) -> T_Item:",
        "    79       await checkpoint()",
        "    80       try:",
        "--> 81           return self.receive_nowait()",
        "    82       except WouldBlock:",
        "    ..................................................",
        "     self = MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max",
        "             _buffer_size=0, buffer=deque([]), open_send_channels=0, open",
        "             _receive_channels=1, waiting_receivers=OrderedDict(), waitin",
        "             g_senders=OrderedDict()), _closed=False)",
        "     T_Item = ~T_Item",
        "     self.receive_nowait = <method 'MemoryObjectReceiveStream.receive_nowait' of Memory",
        "                            ObjectReceiveStream(_state=MemoryObjectStreamState(max_buffe",
        "                            r_size=0, buffer=deque([]), open_send_channels=0, open_recei",
        "                            ve_channels=1, waiting_receivers=OrderedDict(), waiting_send",
        "                            ers=OrderedDict()), _closed=False) memory.py:50>",
        "     WouldBlock = <class 'anyio.WouldBlock'>",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/anyio/streams/memory.py\", line 74, in receive_nowait",
        "    50   def receive_nowait(self) -> T_Item:",
        " (...)",
        "    70   ",
        "    71       if self._state.buffer:",
        "    72           return self._state.buffer.popleft()",
        "    73       elif not self._state.open_send_channels:",
        "--> 74           raise EndOfStream",
        "    75   ",
        "    ..................................................",
        "     self = MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max",
        "             _buffer_size=0, buffer=deque([]), open_send_channels=0, open",
        "             _receive_channels=1, waiting_receivers=OrderedDict(), waitin",
        "             g_senders=OrderedDict()), _closed=False)",
        "     T_Item = ~T_Item",
        "     self._state.buffer = deque([])",
        "     self._state.open_send_channels = 0",
        "     EndOfStream = <class 'anyio.EndOfStream'>",
        "    ..................................................",
        "",
        "EndOfStream",
        "",
        "While handling the above exception, another exception occurred:",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/./app/core/middleware.py\", line 87, in __call__",
        "    71   async def __call__(",
        "    72           self,",
        "    73           request: Request,",
        "    74           call_next: RequestResponseEndpoint,",
        "    75           *args,",
        "    76           **kwargs",
        "    77   ):",
        " (...)",
        "    83       request_headers: dict = dict(request.headers.items())",
        "    84   ",
        "    85       # Response Side",
        "    86       try:",
        "--> 87           response = await call_next(request)",
        "    88       except Exception as ex:",
        "    ..................................................",
        "     self = <app.core.middleware.LoggingMiddleware object at 0x7fbeb2d80",
        "             e20>",
        "     request = <starlette.requests.Request object at 0x7fbeb2d331c0>",
        "     Request = <class 'starlette.requests.Request'>",
        "     RequestResponseEndpoint = typing.Callable[[starlette.requests.Request], typing.Awaitab",
        "                                le[starlette.responses.Response]]",
        "     args = ()",
        "     kwargs = {}",
        "     request_headers = {'host': '127.0.0.1:8888',",
        "                        'connection': 'keep-alive',",
        "                        'sec-ch-ua': '\"Chromium\";v=\"98\", \" Not A;Brand\";v=\"99\"',",
        "                        'accept': 'application/json',",
        "                        'sec-ch-ua-mobile': '?0',",
        "                        'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/",
        "                        537.36 (KHTML, like Gecko) Chrome/98.0.4758.121 Safari/537.3",
        "                        6',",
        "                        'sec-ch-ua-platform': '\"Linux\"',",
        "                        'sec-fetch-site': 'same-origin',",
        "                        'sec-fetch-mode': 'cors',",
        "                        'sec-fetch-dest': 'empty',",
        "                        'referer': 'http://127.0.0.1:8888/docs',",
        "                        'accept-encoding': 'gzip, deflate, br'...",
        "     response = <starlette.responses.Response object at 0x7fbeb2cfb400>",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/middleware/base.py\", line 44, in call_next",
        "    25   async def call_next(request: Request) -> Response:",
        " (...)",
        "--> 44               raise app_exc",
        "    ..................................................",
        "     request = <starlette.requests.Request object at 0x7fbeb2d331c0>",
        "     Request = <class 'starlette.requests.Request'>",
        "     Response = <class 'starlette.responses.Response'>",
        "     app_exc = ZeroDivisionError('division by zero')",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/middleware/base.py\", line 34, in coro",
        "    await self.app(scope, request.receive, send_stream.send)",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/middleware/cors.py\", line 84, in __call__",
        "    await self.app(scope, receive, send)",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/exceptions.py\", line 82, in __call__",
        "    raise exc",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/exceptions.py\", line 71, in __call__",
        "    await self.app(scope, receive, sender)",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/fastapi/middleware/asyncexitstack.py\", line 21, in __call__",
        "    12   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:",
        " (...)",
        "    17               try:",
        "    18                   await self.app(scope, receive, send)",
        "    19               except Exception as e:",
        "    20                   dependency_exception = e",
        "--> 21                   raise e",
        "    22           if dependency_exception:",
        "    ..................................................",
        "     self = <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware ",
        "             object at 0x7fbeb2d181c0>",
        "     scope = {'type': 'http',",
        "              'asgi': {'version': '3.0',",
        "                       'spec_version': '2.3'},",
        "              'http_version': '1.1',",
        "              'server': ('127.0.0.1', 8888, ),",
        "              'client': ('127.0.0.1', 48234, ),",
        "              'scheme': 'http',",
        "              'method': 'GET',",
        "              'root_path': '',",
        "              'path': '/error',",
        "              'raw_path': b'/error',",
        "              'query_string': b'one=1&two=0',",
        "              'headers': [(...), (...), (...), (...), (...), (...), (...)",
        "              , (...), (...), (...), (...), (...), (...), (...), ],",
        "              'app': <fastapi.applications.FastAPI object at 0x7fbeb389fd",
        "              c0>,",
        "              'fastapi_astack':...",
        "     Scope = typing.MutableMapping[str, typing.Any]",
        "     receive = ReceiveProxy(receive=<function MessageLoggerMiddleware.__cal",
        "                l__.<locals>.inner_receive at 0x7fbeb2cce430>, cached_body=b",
        "                '')",
        "     Receive = typing.Callable[[], typing.Awaitable[typing.MutableMapping[s",
        "                tr, typing.Any]]]",
        "     Send = typing.Callable[[typing.MutableMapping[str, typing.Any]], ty",
        "             ping.Awaitable[NoneType]]",
        "     self.app = <fastapi.routing.APIRouter object at 0x7fbeb389fe50>",
        "     dependency_exception = ZeroDivisionError('division by zero')",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__",
        "    12   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:",
        " (...)",
        "    14           dependency_exception: Optional[Exception] = None",
        "    15           async with AsyncExitStack() as stack:",
        "    16               scope[self.context_name] = stack",
        "    17               try:",
        "--> 18                   await self.app(scope, receive, send)",
        "    19               except Exception as e:",
        "    ..................................................",
        "     self = <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware ",
        "             object at 0x7fbeb2d181c0>",
        "     scope = {'type': 'http',",
        "              'asgi': {'version': '3.0',",
        "                       'spec_version': '2.3'},",
        "              'http_version': '1.1',",
        "              'server': ('127.0.0.1', 8888, ),",
        "              'client': ('127.0.0.1', 48234, ),",
        "              'scheme': 'http',",
        "              'method': 'GET',",
        "              'root_path': '',",
        "              'path': '/error',",
        "              'raw_path': b'/error',",
        "              'query_string': b'one=1&two=0',",
        "              'headers': [(...), (...), (...), (...), (...), (...), (...)",
        "              , (...), (...), (...), (...), (...), (...), (...), ],",
        "              'app': <fastapi.applications.FastAPI object at 0x7fbeb389fd",
        "              c0>,",
        "              'fastapi_astack':...",
        "     Scope = typing.MutableMapping[str, typing.Any]",
        "     receive = ReceiveProxy(receive=<function MessageLoggerMiddleware.__cal",
        "                l__.<locals>.inner_receive at 0x7fbeb2cce430>, cached_body=b",
        "                '')",
        "     Receive = typing.Callable[[], typing.Awaitable[typing.MutableMapping[s",
        "                tr, typing.Any]]]",
        "     Send = typing.Callable[[typing.MutableMapping[str, typing.Any]], ty",
        "             ping.Awaitable[NoneType]]",
        "     dependency_exception = ZeroDivisionError('division by zero')",
        "     Optional = typing.Optional",
        "     AsyncExitStack = <class 'contextlib.AsyncExitStack'>",
        "     stack = <contextlib.AsyncExitStack object at 0x7fbeb2d33580>",
        "     self.context_name = 'fastapi_astack'",
        "     self.app = <fastapi.routing.APIRouter object at 0x7fbeb389fe50>",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/routing.py\", line 656, in __call__",
        "    635  async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:",
        " (...)",
        "--> 656              await route.handle(scope, receive, send)",
        "    ..................................................",
        "     self = <fastapi.routing.APIRouter object at 0x7fbeb389fe50>",
        "     scope = {'type': 'http',",
        "              'asgi': {'version': '3.0',",
        "                       'spec_version': '2.3'},",
        "              'http_version': '1.1',",
        "              'server': ('127.0.0.1', 8888, ),",
        "              'client': ('127.0.0.1', 48234, ),",
        "              'scheme': 'http',",
        "              'method': 'GET',",
        "              'root_path': '',",
        "              'path': '/error',",
        "              'raw_path': b'/error',",
        "              'query_string': b'one=1&two=0',",
        "              'headers': [(...), (...), (...), (...), (...), (...), (...)",
        "              , (...), (...), (...), (...), (...), (...), (...), ],",
        "              'app': <fastapi.applications.FastAPI object at 0x7fbeb389fd",
        "              c0>,",
        "              'fastapi_astack':...",
        "     Scope = typing.MutableMapping[str, typing.Any]",
        "     receive = ReceiveProxy(receive=<function MessageLoggerMiddleware.__cal",
        "                l__.<locals>.inner_receive at 0x7fbeb2cce430>, cached_body=b",
        "                '')",
        "     Receive = typing.Callable[[], typing.Awaitable[typing.MutableMapping[s",
        "                tr, typing.Any]]]",
        "     Send = typing.Callable[[typing.MutableMapping[str, typing.Any]], ty",
        "             ping.Awaitable[NoneType]]",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/routing.py\", line 259, in handle",
        "    await self.app(scope, receive, send)",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/starlette/routing.py\", line 61, in app",
        "    response = await func(request)",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/fastapi/routing.py\", line 227, in app",
        "    187  async def app(request: Request) -> Response:",
        " (...)",
        "    223      values, errors, background_tasks, sub_response, _ = solved_result",
        "    224      if errors:",
        "    225          raise RequestValidationError(errors, body=body)",
        "    226      else:",
        "--> 227          raw_response = await run_endpoint_function(",
        "    228              dependant=dependant, values=values, is_coroutine=is_coroutine",
        "    ..................................................",
        "     request = <starlette.requests.Request object at 0x7fbeb2d33070>",
        "     Request = <class 'starlette.requests.Request'>",
        "     Response = <class 'starlette.responses.Response'>",
        "     values = {'one': 1,",
        "               'two': 0}",
        "     errors = []",
        "     background_tasks = None",
        "     sub_response = <starlette.responses.Response object at 0x7fbeb2d33610>",
        "     _ = {}",
        "     solved_result = (",
        "                      {'one': 1,",
        "                       'two': 0}, ",
        "                     [], None, <starlette.responses.Response object at 0x7fbeb2d3",
        "                      3610>, {}, )",
        "     RequestValidationError = <class 'fastapi.exceptions.RequestValidationError'>",
        "     body = None",
        "     dependant = <fastapi.dependencies.models.Dependant object at 0x7fbeb2d18",
        "                  ac0>",
        "     is_coroutine = True",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/venv/lib/python3.8/site-packages/fastapi/routing.py\", line 160, in run_endpoint_function",
        "    152  async def run_endpoint_function(",
        "    153      *, dependant: Dependant, values: Dict[str, Any], is_coroutine: bool",
        "    154  ) -> Any:",
        " (...)",
        "    156      # facilitate profiling endpoints, since inner functions are harder to profile.",
        "    157      assert dependant.call is not None, \"dependant.call must be a function\"",
        "    158  ",
        "    159      if is_coroutine:",
        "--> 160          return await dependant.call(**values)",
        "    161      else:",
        "    ..................................................",
        "     dependant = <fastapi.dependencies.models.Dependant object at 0x7fbeb2d18",
        "                  ac0>",
        "     Dependant = <class 'fastapi.dependencies.models.Dependant'>",
        "     values = {'one': 1,",
        "               'two': 0}",
        "     Dict = typing.Dict",
        "     Any = typing.Any",
        "     is_coroutine = True",
        "     dependant.call = <function 'error' main.py:39>",
        "    ..................................................",
        "",
        "File \"/home/mostepan/dev/allgit/fastapi-json-log/./app/main.py\", line 44, in error",
        "    40   async def error(one: int, two: int):",
        "    41       \"\"\" Example with traceback",
        "    42       \"\"\"",
        "    43       logger.info(f\"Got /error, {one=}, {two=}\")",
        "--> 44       return one / two",
        "    ..................................................",
        "     one = 1",
        "     two = 0",
        "     logger.info = <method 'Logger.info' of <Logger main (DEBUG)> __init__.py:1",
        "                    436>",
        "    ..................................................",
        "",
        "ZeroDivisionError: division by zero"
    ],
        "request_uri": "http://127.0.0.1:8888/error?one=1&two=0",
        "request_referer": "http://127.0.0.1:8888/docs",
        "request_method": "GET",
        "request_path": "/error",
        "request_host": "127.0.0.1:8888",
        "request_size": 0,
        "request_content_type": "",
        "request_headers": {
            "host": "127.0.0.1:8888",
            "connection": "keep-alive",
            "sec-ch-ua": "\"Chromium\";v=\"98\", \" Not A;Brand\";v=\"99\"",
            "accept": "application/json",
            "sec-ch-ua-mobile": "?0",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.121 Safari/537.36",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-site": "same-origin",
            "sec-fetch-mode": "cors",
            "sec-fetch-dest": "empty",
            "referer": "http://127.0.0.1:8888/docs",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7",
            "cookie": "_pk_id.1.dc78=4ec40eae396f1c32.1645453915.; GUID_20B40965CCF8B7300FCB1E3B5CB9925FB27970B0_8888=NcjlKqKxMJq9RgiYXEf3; io=fSKn7g-dE_J63nxDAAAA"
        },
    "request_body": "",
    "request_direction": "in",
    "response_status_code": 500,
    "response_size": 0,
    "response_headers": {},
    "response_body": "Internal Server Error"
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Shutting down",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:51:13+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 599
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Waiting for application shutdown.",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:51:13+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 701
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Application shutdown complete.",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:51:13+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 702
}
{
    "thread": 459014,
    "level_name": "Information",
    "message": "Finished server process [459014]",
    "source_log": "uvicorn.error",
    "@timestamp": "2022-03-16T09:51:13+03:00",
    "app_name": "FastAPI example application",
    "app_version": "0.0.1",
    "app_env": "dev",
    "duration": 703
}
